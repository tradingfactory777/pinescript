// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © TradingFactory_

//@version=6
indicator('프로젝트 1 - 이평선 & RSI 신호 지표', shorttitle = '이평선&RSI', overlay = false)

// 사용자 설정 입력값
lenMA = input.int(20, title = '이동평균선 기간', minval = 1)
lenRSI = input.int(14, title = 'RSI 기간', minval = 1)
rsiOB = input.int(70, title = 'RSI 과매수 레벨', minval = 1, maxval = 100)
rsiOS = input.int(30, title = 'RSI 과매도 레벨', minval = 1, maxval = 100)

// 지표 계산
ma = ta.sma(close, lenMA)
rsi = ta.rsi(close, lenRSI)
length = 3
length2 = 1000
highest = ta.highest(length2)
lowest = ta.lowest(length2)
middle = (highest + lowest) / 2

var bool OS = false
oversell = ta.crossover(rsi, rsiOS)
if oversell
    OS := true
OS_true_index = ta.valuewhen(OS, bar_index, 0)
buySignal_pre = bar_index - OS_true_index < length

var bool OB = false
overbuy = ta.crossunder(rsi, rsiOB)
if overbuy
    OB := true
OB_true_index = ta.valuewhen(OB, bar_index, 0)
sellSignal_pre = bar_index - OB_true_index < length

// 매수 및 매도 신호 로직
// 매수 신호: 가격이 이동평균선 위에 있고, RSI가 과매도 구간에서 반등할 때
buySignal = close < ma and buySignal_pre and middle > close

// 매도 신호: 가격이 이동평균선 아래에 있고, RSI가 과매수 구간에서 하락할 때
sellSignal = close > ma and sellSignal_pre and middle < close

if buySignal
    OS := false
if sellSignal
    OB := false

// 신호에 따라 화살표 그리기
plotshape(buySignal, style = shape.triangleup, location = location.belowbar, color = color.new(color.green, 0), size = size.small, force_overlay = true)
plotshape(sellSignal, style = shape.triangledown, location = location.abovebar, color = color.new(color.red, 0), size = size.small, force_overlay = true)

// 지표 시각화
plot(ma, color = color.new(color.blue, 0), title = '이동평균선', force_overlay = true)

// RSI 지표를 별도 창에 그리기 (오버레이 비활성화)
plot(rsi, title = 'RSI')
hline(rsiOB, '과매수', color = color.new(color.red, 50))
hline(rsiOS, '과매도', color = color.new(color.green, 50))
